@startuml
skinparam packageStyle rectangle
skinparam classAttributeIconSize 0

' =================== PACOTES ===================
package "authentication" {
  class AuthService {
    +login(email, senha): Usuario
    +logout(): void
    +validarSessao(): boolean
  }
  
  class SessionManager {
    +criarSessao(idUsuario): string
    +encerrarSessao(): void
    +getUsuarioLogado(): Usuario
  }
}

package "domain.entities" {
  abstract class Pessoa {
    +id: int
    +nome_completo: string
    +cpf: string
    +telefone: string
    +data_nascimento: date
    +genero: string
    +ativo: boolean
  }

  class Usuario {
    +email: string
    +senha: string
    +tipo_usuario: string
    +data_cadastro: datetime
    +data_atualizacao: datetime
    +fazerLogin(): boolean
    +editarPerfil(): void
  }

  Usuario --|> Pessoa
  class Admin
  class Cliente

  Cliente --|> Usuario
  Admin --|> Usuario
  
  class Veiculo {
    +id: int
    +marca: string
    +modelo: string
    +ano: int
    +preco: decimal
    +combustivel: string
    +cambio: string
    +cor: string
    +descricao: string
    +status: string
    +quilometragem: int
    +destaque: boolean
    +data_cadastro: datetime
  }
  
  class Imagem {
    +id: int
    +veiculo_id: int
    +url: string
    +ordem: int
    +uploadImagem(): boolean
  }

  Veiculo "1" -- "0..*" Imagem

  class Catalogo {
    +id: int
    +nome: string
    +descricao: string
    +ativo: boolean
    +listarVeiculos(): List<Veiculo>
  }

  Catalogo "1" -- "0..*" Veiculo
  
  class Anuncio {
    +id: int
    +veiculo_id: int
    +usuario_id: int
    +titulo: string
    +descricao: string
    +preco: decimal
    +data_publicacao: datetime
    +estado_anuncio: string
    +publicarAnuncio(): void
    +editarAnuncio(): void
    +desativarAnuncio(): void
  }

  Cliente "1" -- "0..*" Anuncio

  class Favorito {
    +id: int
    +usuario_id: int
    +veiculo_id: int
    +data_adicao: datetime
    +adicionarFavorito(): boolean
    +removerFavorito(): boolean
  }

  Cliente "1" -- "0..*" Favorito
  Veiculo "1" -- "0..*" Favorito

  class Notificacao {
    +id: int
    +usuario_id: int
    +titulo: string
    +mensagem: string
    +lida: boolean
    +data_envio: datetime
    +marcarComoLida(): void
  }

  Usuario "1" -- "0..*" Notificacao
}

' =================== REPOSITORIES ===================
package "repositories" {
  interface IRepository {
    +findById(id: int): object
    +findAll(): List<object>
    +save(object): boolean
    +delete(id: int): boolean
  }
  
  class UserRepository
  class VehicleRepository
  class AnuncioRepository
  class ImageRepository
  class FavoritoRepository
  class NotificacaoRepository
  
  IRepository <|.. UserRepository
  IRepository <|.. VehicleRepository
  IRepository <|.. AnuncioRepository
  IRepository <|.. ImageRepository
  IRepository <|.. FavoritoRepository
  IRepository <|.. NotificacaoRepository
}

' =================== SERVICES ===================
package "services" {
  class UserService {
    +atualizarPerfil(): Usuario
    +alterarSenha(): boolean
  }

  class VehicleService {
    +cadastrarVeiculo(): boolean
    +listarVeiculos(): List<Veiculo>
    +buscarDetalhesVeiculo(id: int): Veiculo
  }

  class AnuncioService {
    +publicarAnuncio(): boolean
    +buscarAnuncios(): List<Anuncio>
  }

  class CatalogoService {
    +adicionarVeiculo(): boolean
    +removerVeiculo(): boolean
  }

  class GaleriaService {
    +carregarImagensVeiculo(veiculoId: int): List<Imagem>
    +adicionarImagem(veiculoId: int, imagem: Imagem): boolean
  }

  class FavoritoService {
    +adicionarFavorito(usuarioId: int, veiculoId: int): boolean
    +removerFavorito(usuarioId: int, veiculoId: int): boolean
    +listarFavoritos(usuarioId: int): List<Veiculo>
  }

  UserService --> UserRepository
  VehicleService --> VehicleRepository
  AnuncioService --> AnuncioRepository
  CatalogoService --> VehicleRepository
  GaleriaService --> ImageRepository
  FavoritoService --> FavoritoRepository
}

' =================== CONTROLLERS/API ===================
package "api.controllers" {
  class UserController {
    +getUsuario(): Usuario
    +update(): boolean
  }
  
  class VehicleController {
    +listarVeiculos(): List<Veiculo>
    +salvarVeiculo(): boolean
    +detalhesVeiculo(id: int): Veiculo
  }

  class AnuncioController {
    +listarAnuncios(): List<Anuncio>
    +salvarAnuncio(): boolean
  }

  class GaleriaController {
    +carregarGaleria(veiculoId: int): List<Imagem>
    +uploadImagem(veiculoId: int, imagem: File): boolean
  }

  class FavoritoController {
    +adicionarFavorito(veiculoId: int): boolean
    +removerFavorito(veiculoId: int): boolean
    +listarFavoritos(): List<Veiculo>
  }

  class ApiGateway
}

ApiGateway --> UserController
ApiGateway --> VehicleController
ApiGateway --> AnuncioController
ApiGateway --> GaleriaController
ApiGateway --> FavoritoController

UserController --> UserService
VehicleController --> VehicleService
AnuncioController --> AnuncioService
GaleriaController --> GaleriaService
FavoritoController --> FavoritoService

' =================== UTILS ===================
package "utils" {
  class Validator {
    +validarCPF(): boolean
    +validarEmail(): boolean
  }

  class NotificacaoService {
    +enviarEmail(): void
    +enviarSMS(): void
  }

  class ImageProcessor {
    +compressImage(): string
    +resizeImage(): string
    +generateThumbnail(): string
  }

  class FinanceCalculator {
    +calcularParcelas(valor: decimal, entrada: decimal, meses: int): List<Parcela>
    +calcularJuros(valor: decimal, taxa: decimal): decimal
  }
}

' =================== RELACIONAMENTOS IMPORTANTES ===================
AuthService --> UserRepository
AuthService --> SessionManager
VehicleService --> ImageProcessor
GaleriaService --> ImageProcessor
NotificacaoService ..> Usuario
VehicleController --> FinanceCalculator

@enduml